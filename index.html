<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CoolingLoadEstimate</title>
    
    <!-- React & ReactDOM (Sử dụng CDN ổn định) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel Standalone -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        /* Thêm loading spinner css đơn giản */
        .loading { border: 4px solid #f3f3f3; border-top: 4px solid #3498db; border-radius: 50%; width: 40px; height: 40px; animation: spin 2s linear infinite; margin: 20px auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="bg-slate-50">
    <!-- Hiển thị Loading ban đầu, React sẽ thay thế cái này khi load xong -->
    <div id="root">
        <div style="text-align: center; padding-top: 50px; color: #666;">
            <div class="loading"></div>
            <p>Đang tải ứng dụng...</p>
            <small>(Nếu quá lâu, hãy kiểm tra kết nối mạng để tải thư viện React)</small>
        </div>
    </div>

    <!-- Script báo lỗi nếu React không chạy -->
    <script>
        window.onerror = function(message, source, lineno, colno, error) {
            document.getElementById('root').innerHTML = `
                <div style="color: red; padding: 20px; text-align: center;">
                    <h3>Đã xảy ra lỗi!</h3>
                    <p>${message}</p>
                    <small>Nguồn: ${source} (Dòng: ${lineno})</small>
                </div>
            `;
        };
    </script>

    <script type="text/babel" data-presets="react">
        // Kiểm tra xem React đã tải chưa
        if (typeof React === 'undefined' || typeof ReactDOM === 'undefined') {
            throw new Error("Không thể tải thư viện React/ReactDOM. Vui lòng kiểm tra kết nối mạng.");
        }

        const { useState, useEffect, useMemo } = React;

        // --- ICON COMPONENTS ---
        const Icon = ({ children, className, ...props }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} {...props}>
                {children}
            </svg>
        );

        const Calculator = (props) => <Icon {...props}><rect width="16" height="20" x="4" y="2" rx="2"/><line x1="8" x2="16" y1="6" y2="6"/><line x1="16" x2="16" y1="14" y2="18"/><path d="M16 10h.01"/><path d="M12 10h.01"/><path d="M8 10h.01"/><path d="M12 14h.01"/><path d="M8 14h.01"/><path d="M12 18h.01"/><path d="M8 18h.01"/></Icon>;
        const Thermometer = (props) => <Icon {...props}><path d="M14 4v10.54a4 4 0 1 1-4 0V4a2 2 0 0 1 4 0Z"/></Icon>;
        const Wind = (props) => <Icon {...props}><path d="M17.7 7.7a2.5 2.5 0 1 1 1.8 4.3H2"/><path d="M9.6 4.6A2 2 0 1 1 11 8H2"/><path d="M12.6 19.4A2 2 0 1 1 14 16H2"/></Icon>;
        const Snowflake = (props) => <Icon {...props}><line x1="2" x2="22" y1="12" y2="12"/><line x1="12" x2="12" y1="2" y2="22"/><path d="m20 16-4-4 4-4"/><path d="m4 8 4 4-4 4"/><path d="m16 4-4 4-4-4"/><path d="m8 20 4-4 4 4"/></Icon>;
        const Info = (props) => <Icon {...props}><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></Icon>;
        const RotateCcw = (props) => <Icon {...props}><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></Icon>;
        const Copy = (props) => <Icon {...props}><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></Icon>;
        const Check = (props) => <Icon {...props}><polyline points="20 6 9 17 4 12"/></Icon>;
        const Plus = (props) => <Icon {...props}><path d="M5 12h14"/><path d="M12 5v14"/></Icon>;
        const Trash2 = (props) => <Icon {...props}><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></Icon>;
        const List = (props) => <Icon {...props}><line x1="8" x2="21" y1="6" y2="6"/><line x1="8" x2="21" y1="12" y2="12"/><line x1="8" x2="21" y1="18" y2="18"/><line x1="3" x2="3.01" y1="6" y2="6"/><line x1="3" x2="3.01" y1="12" y2="12"/><line x1="3" x2="3.01" y1="18" y2="18"/></Icon>;
        const Pencil = (props) => <Icon {...props}><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/><path d="m15 5 4 4"/></Icon>;
        
        // --- APP COMPONENT ---
        const MultiPurposeLoadCalc = () => {
            const [area, setArea] = useState('');
            const [zoneType, setZoneType] = useState('sales_general');
            const [ceilingHeight, setCeilingHeight] = useState('standard');
            const [zoneName, setZoneName] = useState('');
            const [result, setResult] = useState(null);
            const [copied, setCopied] = useState(false);
            const [savedZones, setSavedZones] = useState([]);
            const [editingId, setEditingId] = useState(null); // State để theo dõi đang sửa dòng nào

            // CẬP NHẬT: Định mức nhiệt tải chi tiết cho nhiều loại hình (BTU/m2)
            const loadFactors = {
                // --- NHÓM SIÊU THỊ ---
                sales_general: { label: 'Siêu thị - Khu bán hàng chung', value: 750, desc: 'Kệ đồ khô, mật độ trung bình.', group: 'Siêu thị / Thương mại' },
                sales_fresh: { label: 'Siêu thị - Khu đồ tươi/đông lạnh', value: 650, desc: 'Có tủ mát hỗ trợ tải.', group: 'Siêu thị / Thương mại' },
                checkout: { label: 'Siêu thị - Thu ngân/Cửa', value: 950, desc: 'Mật độ người cao, thất thoát nhiệt.', group: 'Siêu thị / Thương mại' },
                warehouse: { label: 'Kho chứa hàng', value: 550, desc: 'Ít người, chủ yếu bảo quản.', group: 'Siêu thị / Thương mại' },

                // --- NHÓM NHÀ Ở / CĂN HỘ ---
                res_bedroom: { label: 'Nhà ở - Phòng ngủ', value: 600, desc: 'Tải nhiệt thấp, không gian kín.', group: 'Nhà ở / Căn hộ' },
                res_living: { label: 'Nhà ở - Phòng khách', value: 800, desc: 'Không gian mở, TV, đèn, đi lại.', group: 'Nhà ở / Căn hộ' },
                res_kitchen: { label: 'Nhà ở - Bếp ăn', value: 900, desc: 'Sinh nhiệt từ nấu nướng.', group: 'Nhà ở / Căn hộ' },

                // --- NHÓM VĂN PHÒNG ---
                office_general: { label: 'Văn phòng - Làm việc chung', value: 750, desc: 'Máy tính, người ngồi tĩnh.', group: 'Văn phòng' },
                office_meeting: { label: 'Văn phòng - Phòng họp', value: 1000, desc: 'Mật độ người dày đặc, máy chiếu.', group: 'Văn phòng' },

                // --- NHÓM GIÁO DỤC ---
                school_class: { label: 'Lớp học tiêu chuẩn', value: 750, desc: 'Đông người nhưng ít thiết bị nhiệt.', group: 'Trường học / Nhà trẻ' },
                school_nap: { label: 'Phòng ngủ trưa (Nhà trẻ)', value: 600, desc: 'Yêu cầu yên tĩnh, tải thấp.', group: 'Trường học / Nhà trẻ' },
                school_hall: { label: 'Hội trường / Phòng chức năng', value: 900, desc: 'Không gian lớn, trần cao.', group: 'Trường học / Nhà trẻ' },

                // --- NHÓM DỊCH VỤ KHÁC ---
                restaurant: { label: 'Nhà hàng / Quán ăn', value: 1000, desc: 'Mùi thức ăn, người ra vào nhiều.', group: 'Dịch vụ khác' },
                hotel_room: { label: 'Khách sạn - Phòng ngủ', value: 650, desc: 'Tải tương đương phòng ngủ nhà ở.', group: 'Dịch vụ khác' },
                server_room: { label: 'Phòng Server / Máy chủ', value: 1500, desc: 'Thiết bị tỏa nhiệt cực lớn (Cần tính kỹ).', group: 'Dịch vụ khác' },
            };

            const heightFactors = {
                standard: { label: 'Tiêu chuẩn (< 3.5m)', multiplier: 1.0 },
                high: { label: 'Cao (3.5m - 5m)', multiplier: 1.15 },
                very_high: { label: 'Thông tầng (> 5m)', multiplier: 1.3 },
            };

            // Gom nhóm danh sách để hiển thị trong Select
            const groupedOptions = useMemo(() => {
                const groups = {};
                Object.entries(loadFactors).forEach(([key, data]) => {
                    if (!groups[data.group]) groups[data.group] = [];
                    groups[data.group].push({ key, ...data });
                });
                return groups;
            }, []);

            useEffect(() => {
                calculateLoad();
            }, [area, zoneType, ceilingHeight]);

            const calculateLoad = () => {
                const areaNum = parseFloat(area);
                if (!areaNum || areaNum <= 0) {
                    setResult(null);
                    return;
                }

                const baseLoadPerM2 = loadFactors[zoneType].value;
                const heightMultiplier = heightFactors[ceilingHeight].multiplier;

                const totalBtu = Math.round(areaNum * baseLoadPerM2 * heightMultiplier);
                const hp = (totalBtu / 9000).toFixed(1);
                const kw = (totalBtu / 3412).toFixed(1);
                const ton = (totalBtu / 12000).toFixed(1);

                setResult({ btu: totalBtu, hp: hp, kw: kw, ton: ton });
            };

            const handleSaveZone = () => {
                if (!result || !area) return;

                const zoneData = {
                    name: zoneName || `Khu vực ${savedZones.length + 1}`,
                    area: parseFloat(area),
                    zoneType, // Lưu key để dễ edit
                    zoneTypeLabel: loadFactors[zoneType].label,
                    ceilingHeight, // Lưu key để dễ edit
                    ceilingHeightLabel: heightFactors[ceilingHeight].label,
                    btu: result.btu,
                    hp: parseFloat(result.hp),
                    kw: parseFloat(result.kw)
                };

                if (editingId) {
                    // Cập nhật dòng đang sửa
                    setSavedZones(savedZones.map(z => z.id === editingId ? { ...zoneData, id: editingId } : z));
                    setEditingId(null);
                } else {
                    // Thêm mới
                    setSavedZones([...savedZones, { ...zoneData, id: Date.now() }]);
                }
                
                // Reset form
                setZoneName('');
                setArea('');
                setResult(null);
            };

            const handleEditZone = (zone) => {
                setArea(zone.area);
                setZoneType(zone.zoneType);
                setCeilingHeight(zone.ceilingHeight);
                setZoneName(zone.name);
                setEditingId(zone.id);
            };

            const handleDeleteZone = (id) => {
                setSavedZones(savedZones.filter(z => z.id !== id));
                if (editingId === id) handleCancelEdit();
            };

            const handleCancelEdit = () => {
                setEditingId(null);
                setZoneName('');
                setArea('');
                setResult(null);
            };

            const handleReset = () => {
                handleCancelEdit();
                setZoneType('sales_general');
                setCeilingHeight('standard');
            };

            const copyToClipboard = () => {
                let text = "";
                if (savedZones.length > 0) {
                    text = "BẢNG TÍNH TẢI LẠNH TỔNG HỢP\n---------------------------\n";
                    savedZones.forEach((z, i) => {
                        text += `${i + 1}. ${z.name} (${z.area}m2): ${z.kw} kW | ${z.hp} HP | ${z.btu.toLocaleString()} BTU/h\n`;
                    });
                    text += "---------------------------\n";
                    text += `TỔNG CỘNG: ${totalStats.kw.toFixed(1)} kW | ${totalStats.hp.toFixed(1)} HP | ${totalStats.btu.toLocaleString()} BTU/h`;
                } else if (result) {
                    text = `TÍNH TẢI LẠNH: ${area}m2 - ${result.kw} kW - ${result.hp} HP - ${result.btu.toLocaleString()} BTU/h`;
                } else {
                    return;
                }

                const textArea = document.createElement("textarea");
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                try {
                    document.execCommand('copy');
                    setCopied(true);
                    setTimeout(() => setCopied(false), 2000);
                } catch (err) {
                    console.error('Lỗi copy', err);
                }
                document.body.removeChild(textArea);
            };

            const totalStats = savedZones.reduce((acc, curr) => ({
                area: acc.area + curr.area,
                btu: acc.btu + curr.btu,
                hp: acc.hp + curr.hp,
                kw: acc.kw + curr.kw
            }), { area: 0, btu: 0, hp: 0, kw: 0 });

            const getRecommendation = (hp) => {
                const hpNum = parseFloat(hp);
                if (hpNum < 2.5) return "Máy treo tường (Wall mounted)";
                if (hpNum < 6) return "Máy Cassette hoặc Giấu trần (SkyAir)";
                if (hpNum < 20) return "Tủ đứng hoặc Giấu trần công nghiệp (Packaged)";
                return "Hệ thống trung tâm VRV/VRF hoặc Chiller";
            };

            // Helper để tính W/m2
            const btuToWatt = (btu) => Math.round(btu * 0.293071);
            const btuToKw = (btu) => (btu * 0.293071 / 1000).toFixed(3);

            return (
                <div className="min-h-screen bg-slate-50 p-4 md:p-6 font-sans text-slate-800">
                    <div className="max-w-7xl mx-auto space-y-6">
                        
                        {/* Header */}
                        <div className="bg-white rounded-2xl shadow-sm p-4 md:p-6 border-l-8 border-green-600 flex items-center justify-between">
                            <div>
                                <h1 className="text-2xl md:text-3xl font-bold text-slate-800 flex items-center gap-2">
                                    <Snowflake className="text-green-500 w-8 h-8" />
                                    Tính Tải Lạnh Nhanh
                                </h1>
                                <p className="text-slate-500 mt-1">Công cụ đa dụng: Siêu thị, Nhà ở, Văn phòng, Trường học...</p>
                            </div>
                            <div className="hidden md:block">
                                <Calculator className="w-12 h-12 text-slate-200" />
                            </div>
                        </div>

                        <div className="grid grid-cols-1 md:grid-cols-12 gap-6">
                            
                            {/* --- CỘT TRÁI: NHẬP LIỆU & TÍNH TOÁN NHANH (Small Box) --- */}
                            <div className="md:col-span-4 space-y-4">
                                <div className="bg-white rounded-xl shadow-sm p-5 border border-slate-200 sticky top-4">
                                    <h2 className="text-lg font-semibold mb-4 flex items-center gap-2 text-slate-800">
                                        <Wind className="w-5 h-5 text-green-600" />
                                        {editingId ? 'Sửa thông tin' : 'Thông số khu vực'}
                                    </h2>

                                    <div className="space-y-4">
                                        {/* Input fields */}
                                        <div>
                                            <label className="block text-sm font-medium text-slate-700 mb-1">Tên khu vực</label>
                                            <input
                                                type="text"
                                                value={zoneName}
                                                onChange={(e) => setZoneName(e.target.value)}
                                                placeholder="VD: Phòng khách..."
                                                className="w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 outline-none"
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-slate-700 mb-1">Diện tích (m²) <span className="text-red-500">*</span></label>
                                            <input
                                                type="number"
                                                min="1"
                                                value={area}
                                                onChange={(e) => setArea(e.target.value)}
                                                placeholder="Nhập diện tích..."
                                                className="w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 outline-none font-semibold text-lg"
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-slate-700 mb-1">Loại không gian</label>
                                            <select
                                                value={zoneType}
                                                onChange={(e) => setZoneType(e.target.value)}
                                                className="w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 outline-none bg-white"
                                            >
                                                {Object.entries(groupedOptions).map(([groupName, items]) => (
                                                    <optgroup key={groupName} label={groupName}>
                                                        {items.map(item => (
                                                            <option key={item.key} value={item.key}>{item.label}</option>
                                                        ))}
                                                    </optgroup>
                                                ))}
                                            </select>
                                            
                                            {/* Hiển thị mật độ tải lạnh chi tiết */}
                                            <div className="mt-2 bg-blue-50 p-2 rounded border border-blue-100 text-xs text-blue-800">
                                                <div className="font-semibold mb-1">Mật độ tải lạnh định mức:</div>
                                                <div className="grid grid-cols-2 gap-x-2 gap-y-1">
                                                    <span>• {loadFactors[zoneType].value} BTU/m²</span>
                                                    <span>• {btuToWatt(loadFactors[zoneType].value)} W/m²</span>
                                                    <span className="col-span-2">• {btuToKw(loadFactors[zoneType].value)} kW/m²</span>
                                                </div>
                                                <div className="mt-1 pt-1 border-t border-blue-200 text-slate-500 italic">
                                                    {loadFactors[zoneType].desc}
                                                </div>
                                            </div>
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-slate-700 mb-1">Độ cao trần</label>
                                            <select
                                                value={ceilingHeight}
                                                onChange={(e) => setCeilingHeight(e.target.value)}
                                                className="w-full px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-green-500 outline-none bg-white"
                                            >
                                                {Object.entries(heightFactors).map(([key, data]) => (
                                                    <option key={key} value={key}>{data.label}</option>
                                                ))}
                                            </select>
                                        </div>
                                    </div>

                                    {/* Small Live Preview */}
                                    {result && (
                                        <div className="mt-4 p-3 bg-green-50 rounded-lg border border-green-100 text-center">
                                            <div className="text-xs text-green-600 font-bold uppercase mb-1">Kết quả tính nhanh</div>
                                            <div className="text-2xl font-bold text-green-700">{result.btu.toLocaleString()} <span className="text-sm font-medium">BTU/h</span></div>
                                            <div className="text-sm text-green-600 font-medium">~ {result.hp} HP | {result.kw} kW</div>
                                        </div>
                                    )}

                                    {/* Action Buttons */}
                                    <div className="flex gap-2 mt-4">
                                        <button 
                                            onClick={handleReset}
                                            className="px-4 py-2 border border-slate-300 text-slate-600 rounded-lg hover:bg-slate-50 transition"
                                            title="Đặt lại"
                                        >
                                            <RotateCcw className="w-5 h-5" />
                                        </button>
                                        <button 
                                            onClick={handleSaveZone}
                                            disabled={!result}
                                            className={`flex-1 py-2 px-4 rounded-lg font-bold transition flex items-center justify-center gap-2 shadow-sm ${
                                                result 
                                                ? (editingId ? 'bg-orange-500 hover:bg-orange-600 text-white' : 'bg-blue-600 hover:bg-blue-700 text-white') 
                                                : 'bg-slate-200 text-slate-400 cursor-not-allowed'
                                            }`}
                                        >
                                            {editingId ? <Pencil className="w-5 h-5" /> : <Plus className="w-5 h-5" />}
                                            {editingId ? 'Cập nhật' : 'Thêm dòng'}
                                        </button>
                                        {editingId && (
                                            <button 
                                                onClick={handleCancelEdit}
                                                className="px-3 py-2 border border-red-200 text-red-600 bg-red-50 rounded-lg hover:bg-red-100 transition text-sm font-medium"
                                            >
                                                Hủy
                                            </button>
                                        )}
                                    </div>
                                </div>
                            </div>

                            {/* --- CỘT PHẢI: BẢNG TỔNG HỢP (Big Box) --- */}
                            <div className="md:col-span-8 space-y-4">
                                <div className="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden flex flex-col h-full min-h-[500px]">
                                    <div className="bg-slate-50 p-4 border-b border-slate-200 flex justify-between items-center">
                                        <h3 className="font-bold text-slate-700 flex items-center gap-2">
                                            <List className="w-5 h-5 text-green-600" />
                                            Bảng Tổng Hợp Công Suất
                                        </h3>
                                        {savedZones.length > 0 && (
                                            <button 
                                                onClick={copyToClipboard}
                                                className="flex items-center gap-1 text-xs bg-white border border-slate-300 hover:bg-slate-50 text-slate-700 px-3 py-1.5 rounded-lg transition shadow-sm"
                                            >
                                                {copied ? <Check className="w-3 h-3 text-green-600" /> : <Copy className="w-3 h-3" />}
                                                {copied ? 'Đã chép' : 'Sao chép bảng'}
                                            </button>
                                        )}
                                    </div>
                                    
                                    <div className="overflow-x-auto flex-1">
                                        <table className="w-full text-sm text-left">
                                            <thead className="bg-slate-100 text-slate-600 font-semibold uppercase text-xs sticky top-0">
                                                <tr>
                                                    <th className="px-4 py-3 w-12">STT</th>
                                                    <th className="px-4 py-3">Khu vực</th>
                                                    <th className="px-4 py-3">Loại / Trần</th>
                                                    <th className="px-4 py-3 text-right">Diện tích (m²)</th>
                                                    <th className="px-4 py-3 text-right">kW Lạnh</th>
                                                    <th className="px-4 py-3 text-right">HP</th>
                                                    <th className="px-4 py-3 text-right">BTU/h</th>
                                                    <th className="px-4 py-3 text-center w-24"></th> {/* Cột hành động trống tên */}
                                                </tr>
                                            </thead>
                                            <tbody className="divide-y divide-slate-100">
                                                {savedZones.length === 0 ? (
                                                    <tr>
                                                        <td colSpan="8" className="px-4 py-12 text-center text-slate-400">
                                                            <div className="flex flex-col items-center justify-center">
                                                                <List className="w-12 h-12 text-slate-200 mb-3" />
                                                                <p className="font-medium">Chưa có dữ liệu</p>
                                                                <p className="text-xs mt-1">Vui lòng nhập thông tin bên trái và bấm "Thêm dòng"</p>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                ) : (
                                                    savedZones.map((zone, index) => (
                                                        <tr key={zone.id} className={`hover:bg-slate-50 transition ${editingId === zone.id ? 'bg-blue-50' : ''}`}>
                                                            <td className="px-4 py-3 text-slate-400">{index + 1}</td>
                                                            <td className="px-4 py-3 font-medium text-slate-800">{zone.name}</td>
                                                            <td className="px-4 py-3 text-slate-500">
                                                                <div className="flex flex-col">
                                                                    <span>{zone.zoneTypeLabel}</span>
                                                                    <span className="text-xs text-slate-400">Trần: {zone.ceilingHeightLabel}</span>
                                                                </div>
                                                            </td>
                                                            <td className="px-4 py-3 text-right font-medium">{zone.area}</td>
                                                            <td className="px-4 py-3 text-right font-medium text-slate-600">{zone.kw}</td>
                                                            <td className="px-4 py-3 text-right font-medium">{zone.hp}</td>
                                                            <td className="px-4 py-3 text-right text-green-600 font-semibold">{zone.btu.toLocaleString()}</td>
                                                            <td className="px-4 py-3 text-center">
                                                                <div className="flex items-center justify-center gap-1">
                                                                    <button 
                                                                        onClick={() => handleEditZone(zone)}
                                                                        className="p-1.5 text-slate-400 hover:text-blue-600 hover:bg-blue-50 rounded transition"
                                                                        title="Sửa"
                                                                    >
                                                                        <Pencil className="w-4 h-4" />
                                                                    </button>
                                                                    <button 
                                                                        onClick={() => handleDeleteZone(zone.id)}
                                                                        className="p-1.5 text-slate-400 hover:text-red-500 hover:bg-red-50 rounded transition"
                                                                        title="Xóa"
                                                                    >
                                                                        <Trash2 className="w-4 h-4" />
                                                                    </button>
                                                                </div>
                                                            </td>
                                                        </tr>
                                                    ))
                                                )}
                                            </tbody>
                                        </table>
                                    </div>

                                    {/* Footer Summary */}
                                    {savedZones.length > 0 && (
                                        <div className="bg-slate-800 text-white p-4">
                                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4 items-center">
                                                <div>
                                                    <div className="text-xs text-slate-400 uppercase tracking-wider mb-1">Tổng cộng toàn công trình</div>
                                                    <div className="flex items-baseline gap-4">
                                                        <div className="text-2xl font-bold text-white">{totalStats.hp.toFixed(1)} HP</div>
                                                        <div className="text-sm text-slate-300">~ {totalStats.kw.toFixed(1)} kW Lạnh</div>
                                                        <div className="text-sm text-slate-400 border-l border-slate-600 pl-4">{totalStats.area} m²</div>
                                                    </div>
                                                </div>
                                                <div className="md:text-right">
                                                    <div className="inline-block bg-slate-700 py-2 px-4 rounded-lg border border-slate-600">
                                                        <div className="text-xs text-yellow-400 font-bold uppercase mb-1 flex items-center justify-end gap-1">
                                                            <Info className="w-3 h-3" /> Gợi ý hệ thống
                                                        </div>
                                                        <div className="text-sm font-medium">
                                                            {getRecommendation(totalStats.hp)}
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    )}
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            );
        };

        // Render với cơ chế try-catch
        try {
            const root = ReactDOM.createRoot(document.getElementById('root'));
            root.render(<MultiPurposeLoadCalc />);
        } catch (error) {
            document.body.innerHTML = '<h3 style="color:red; text-align:center; margin-top:50px">Lỗi khởi chạy ứng dụng! Hãy kiểm tra console (F12) để biết chi tiết.</h3>';
            console.error("Lỗi Render:", error);
        }
    </script>
</body>
</html>
